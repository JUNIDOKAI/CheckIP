<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tra IP & V·ªã Tr√≠</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        body { transition: 0.3s; }
        .dark-mode { background-color: #121212; color: white; }
        .dark-mode table { color: white; }
        #map { height: 300px; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">üîç Ki·ªÉm Tra ƒê·ªãa Ch·ªâ IP & V·ªã Tr√≠</h2>
        <button id="toggleDarkMode" class="btn btn-secondary my-3">üåô Ch·∫ø ƒë·ªô t·ªëi</button>
        
        <!-- B·∫£ng hi·ªÉn th·ªã th√¥ng tin -->
        <table id="ipTable" class="table table-striped">
            <thead>
                <tr><th>Th√¥ng Tin</th><th>Chi Ti·∫øt</th></tr>
            </thead>
            <tbody id="infoTableBody"></tbody>
        </table>

        <!-- Google Map -->
        <div id="map"></div>

        <h3 class="mt-4">üì∂ Ki·ªÉm tra t·ªëc ƒë·ªô m·∫°ng</h3>
        <button id="testSpeed" class="btn btn-primary">üîÑ B·∫Øt ƒë·∫ßu ki·ªÉm tra</button>
        <p id="speedResult"></p>
    </div>

    <!-- Script -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap" async defer></script>

    <script>
        // üåô Dark Mode
        if (localStorage.getItem("darkMode") === "enabled") {
            document.body.classList.add("dark-mode");
        }
        document.getElementById("toggleDarkMode").addEventListener("click", function () {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "enabled" : "disabled");
        });

        // üåç L·∫•y th√¥ng tin IP & hi·ªÉn th·ªã
        async function fetchIPInfo() {
            try {
                let response = await fetch("https://ipinfo.io/json?token=YOUR_TOKEN");
                let data = await response.json();
                let [lat, lon] = data.loc.split(',');

                document.getElementById("infoTableBody").innerHTML = `
                    <tr><td>ƒê·ªãa ch·ªâ IP</td><td>${data.ip}</td></tr>
                    <tr><td>Nh√† m·∫°ng</td><td>${data.org || "Kh√¥ng c√≥ d·ªØ li·ªáu"}</td></tr>
                    <tr><td>VPN/Proxy</td><td>${data.bogon ? "C√≥" : "Kh√¥ng"}</td></tr>
                    <tr><td>V·ªã tr√≠</td><td>${data.city}, ${data.region}, ${data.country}</td></tr>
                    <tr><td>Kinh ƒë·ªô & Vƒ© ƒë·ªô</td><td>${lat}, ${lon}</td></tr>
                    <tr><td>M√∫i gi·ªù</td><td>${data.timezone}</td></tr>
                `;

                $('#ipTable').DataTable();
                initMap(parseFloat(lat), parseFloat(lon));
            } catch (error) {
                console.error("L·ªói khi l·∫•y d·ªØ li·ªáu IP:", error);
                document.getElementById("infoTableBody").innerHTML = `<tr><td colspan="2">L·ªói khi t·∫£i d·ªØ li·ªáu</td></tr>`;
            }
        }

        // üó∫ Hi·ªÉn th·ªã Google Maps
        function initMap(lat = 10.7769, lon = 106.7009) { // M·∫∑c ƒë·ªãnh TP.HCM
            let map = new google.maps.Map(document.getElementById("map"), {
                center: { lat, lng: lon },
                zoom: 12,
            });
            new google.maps.Marker({ position: { lat, lng: lon }, map });
        }

        // üöÄ Ki·ªÉm tra t·ªëc ƒë·ªô m·∫°ng
        document.getElementById("testSpeed").addEventListener("click", function () {
            let startTime = new Date().getTime();
            let img = new Image();
            img.src = "https://speed.hetzner.de/100MB.bin?t=" + startTime;
            img.onload = function () {
                let endTime = new Date().getTime();
                let duration = (endTime - startTime) / 1000;
                let speed = (100 / duration).toFixed(2);
                document.getElementById("speedResult").innerHTML = `T·ªëc ƒë·ªô m·∫°ng: ${speed} Mbps`;
            };
        });

        fetchIPInfo();
    </script>
</body>
</html>
